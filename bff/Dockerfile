# 1. Base Image
FROM node:20-slim

# 2. Working Directory
WORKDIR /usr/src/app

# 3. Copy package.json and package-lock.json
# (Assuming package-lock.json will be generated by npm install if not present initially)
# If you have a package-lock.json, it's good to copy it here.
COPY package.json ./
# If package-lock.json exists, uncomment the next line
# COPY package-lock.json ./

# 4. Install Dependencies
# Using --omit=dev to install only production dependencies
# Using npm ci is generally preferred if you have a package-lock.json for reproducible builds.
# If using npm ci, ensure package-lock.json is copied above and is up-to-date.
RUN npm install --omit=dev

# 5. Copy Application Code
# Copy server.js and any other files like .env.example (though .env itself shouldn't be copied)
COPY . .
# More specific copy if preferred:
# COPY server.js .
# COPY .env.example .
# Ensure that if you have other subdirectories or files needed by the server, they are copied too.

# 6. Expose Port
# This should match the BFF_PORT your application listens on.
# The actual port mapping is done when running the container (e.g., with docker run -p).
EXPOSE 3001

# 7. Command
# Use npm start script which is "node server.js"
CMD [ "npm", "start" ]
